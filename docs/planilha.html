<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Componente Planilha Orçamentária - Versão Final</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        :root {
            --bs-primary: #1976D2;
            --bs-primary-rgb: 25, 118, 210;
            --bs-primary-tint: rgba(25, 118, 210, 0.07);
            --bs-secondary: #6c757d;
            --bs-success: #43A047;
            --bs-body-bg: #ffffff;
            --bs-border-color: #dee2e6;
            --bs-gray-100: #f8f9fa;
        }
        body {
            background-color: var(--bs-body-bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            padding-bottom: 80px;
        }

        .breadcrumb { --bs-breadcrumb-padding-x: 0; --bs-breadcrumb-margin-bottom: 0; }
        .breadcrumb a { text-decoration: none; }
        .nav-tabs { border-bottom: 1px solid var(--bs-border-color); }
        .nav-tabs .nav-link { color: var(--bs-secondary); background-color: transparent; border: 1px solid transparent; border-bottom: none; margin-bottom: -1px; }
        .nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link { color: var(--bs-primary); font-weight: 600; background-color: var(--bs-body-bg); border-color: var(--bs-border-color) var(--bs-border-color) var(--bs-body-bg); }
        .nav-tabs .nav-link i { margin-right: 0.5rem; }
        .total-global-widget { background-color: #f8f9fa; padding: .5rem 1rem; border-radius: .375rem; border-left: 4px solid var(--bs-primary); }

        .table-wrapper { border: 1px solid var(--bs-border-color); border-radius: .375rem; overflow-x: auto; }
        .table { margin-bottom: 0; font-size: 14px; white-space: nowrap; }
        .table > thead th { vertical-align: middle; }
        .table > thead .main-header-row th { background-color: var(--bs-gray-100); font-weight: 600; border-bottom-width: 1px; padding-top: .75rem; padding-bottom: .75rem; }
        .table > thead .sub-header-row th { background-color: var(--bs-gray-100); font-weight: 600; border-top: 1px solid var(--bs-border-color); }
        
        .table > thead [data-group-color="base"] { color: var(--bs-secondary); }
        .table > thead [data-group-color="transp"] { color: var(--bs-success); }
        .table > thead [data-group-color="orcamento"] { color: var(--bs-primary); }

        .group-header { background-color: var(--bs-primary-tint); font-weight: bold; font-size: 1em; color: var(--bs-primary); }
        .subgroup-header { font-style: italic; font-weight: 600; color: var(--bs-secondary); }
        .table input[readonly].form-control { background-color: transparent !important; border: none !important; box-shadow: none !important; cursor: default; }
        .table .form-control, .table .form-select { font-size: inherit; }
        
        .table.font-size-sm { font-size: 12px; }
        .table.font-size-md { font-size: 14px; }
        .table.font-size-lg { font-size: 16px; }

        .footer-tabs { background-color: #f8f9fa; border-top: 1px solid var(--bs-border-color); padding: 0 .5rem; z-index: 1030; }
        .description-col { white-space: normal; min-width: 300px; }
        .btn-action { --bs-btn-padding-y: .1rem; --bs-btn-padding-x: .4rem; --bs-btn-font-size: .75rem; }

        /* Estilos para o Modo de Edição em Massa */
        .mass-edit-active .group-header,
        .mass-edit-active .subgroup-header,
        .mass-edit-active .insert-service-cell {
            display: none;
        }
    </style>
</head>
<body>
    <div id="planilha-orcamentaria-component" class="container-fluid pt-3">
        <nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="#">Home</a></li><li class="breadcrumb-item"><a href="#">Projetos</a></li><li class="breadcrumb-item"><a href="#">Orçamentos</a></li><li class="breadcrumb-item active" aria-current="page">Hospital</li></ol></nav>

        <ul class="nav nav-tabs my-3">
            <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-house-door"></i>Início</a></li><li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-percent"></i>BDI</a></li><li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-truck"></i>DMT</a></li><li class="nav-item"><a class="nav-link active" href="#"><i class="bi bi-table"></i>Planilha</a></li><li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-file-earmark-text"></i>Resumo</a></li><li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-calendar-week"></i>Planejamento</a></li><li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-graph-up"></i>Análise</a></li>
        </ul>

        <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 p-3 mb-3 bg-white rounded border">
            <div class="d-flex align-items-center flex-wrap gap-4">
                <div class="d-flex align-items-center gap-2"><label for="lote" class="form-label small mb-0 text-muted">LOTE:</label><input type="text" id="lote" class="form-control form-control-sm" value="01" style="width: 60px;"></div>
                <div class="d-flex align-items-center gap-2"><label for="versao" class="form-label small mb-0 text-muted">Versão:</label><input type="text" id="versao" class="form-control form-control-sm" value="1 - Inicial" style="width: 120px;"></div>
                <div class="btn-group" role="group">
                  <input type="radio" class="btn-check" name="desoneracao" id="comDesoneracao" autocomplete="off" checked><label class="btn btn-sm btn-outline-primary" for="comDesoneracao">Com Desoneração</label>
                  <input type="radio" class="btn-check" name="desoneracao" id="semDesoneracao" autocomplete="off"><label class="btn btn-sm btn-outline-primary" for="semDesoneracao">Sem Desoneração</label>
                </div>
                <div class="btn-group" role="group" id="viewModeToggle">
                  <input type="radio" class="btn-check" name="viewmode" id="hierarchical-view" value="hierarchical" autocomplete="off" checked>
                  <label class="btn btn-sm btn-outline-secondary" for="hierarchical-view"><i class="bi bi-list-nested"></i> Visão Hierárquica</label>
                  <input type="radio" class="btn-check" name="viewmode" id="mass-edit-view" value="mass-edit" autocomplete="off">
                  <label class="btn btn-sm btn-outline-secondary" for="mass-edit-view"><i class="bi bi-pencil-square"></i> Edição em Massa</label>
                </div>
            </div>
            <div class="d-flex align-items-center gap-3">
                <div class="alert alert-warning p-2 m-0 d-flex align-items-center" role="alert"><i class="bi bi-exclamation-triangle-fill me-2"></i><small>Alterações não salvas. <a href="#" class="alert-link">Salvar agora</a></small></div>
                <div class="total-global-widget text-end"><small class="text-muted d-block mb-0">TOTAL GLOBAL</small><strong class="fs-5">R$ 28.308,00</strong></div>
                <div class="btn-group">
                  <button type="button" class="btn btn-light" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false"><i class="bi bi-gear-fill"></i></button>
                  <div class="dropdown-menu dropdown-menu-end p-3" style="width: 320px;">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Tamanho do Texto</label>
                        <div class="btn-group w-100" role="group" id="fontSizeGroup">
                            <button type="button" class="btn btn-sm btn-outline-secondary" data-font-size="sm">Pequeno</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary active" data-font-size="md">Médio</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" data-font-size="lg">Grande</button>
                        </div>
                    </div>
                    <div>
                        <label class="form-label fw-bold">Grupos de Colunas Visíveis</label>
                        <div class="form-check form-switch"><input class="form-check-input column-toggle" type="checkbox" role="switch" id="toggle-info" data-group="info" checked><label class="form-check-label" for="toggle-info">Informações Básicas</label></div>
                        <div class="form-check form-switch"><input class="form-check-input column-toggle" type="checkbox" role="switch" id="toggle-transp" data-group="transp" checked><label class="form-check-label" for="toggle-transp">Transporte</label></div>
                        <div class="form-check form-switch"><input class="form-check-input column-toggle" type="checkbox" role="switch" id="toggle-preco-tabela" data-group="preco-tabela" checked><label class="form-check-label" for="toggle-preco-tabela">Preço Tabela</label></div>
                        <div class="form-check form-switch"><input class="form-check-input column-toggle" type="checkbox" role="switch" id="toggle-preco-bdi" data-group="preco-bdi" checked><label class="form-check-label" for="toggle-preco-bdi">Preço Unitário c/ BDI</label></div>
                        <div class="form-check form-switch"><input class="form-check-input column-toggle" type="checkbox" role="switch" id="toggle-orcamento" data-group="orcamento" checked><label class="form-check-label" for="toggle-orcamento">Preço no Orçamento</label></div>
                    </div>
                  </div>
                </div>
            </div>
        </div>

        <div class="table-responsive table-wrapper mb-5">
            <table id="main-table" class="table table-bordered table-hover table-sm bg-white font-size-md">
                <thead class="text-center">
                    <tr class="main-header-row">
                        <th rowspan="2" style="width: 40px;"></th><th rowspan="2" style="width: 40px;"></th>
                        <th data-group="info" data-group-color="base" colspan="5">INFORMAÇÕES BÁSICAS SOBRE O SERVIÇO</th>
                        <th data-group="transp" data-group-color="transp" colspan="4">TRANSPORTE</th>
                        <th data-group="preco-tabela" data-group-color="base" colspan="2">PREÇO TABELA</th>
                        <th data-group="preco-bdi" data-group-color="orcamento" colspan="3">PREÇO UNITÁRIO COM BDI</th>
                        <th data-group="orcamento" data-group-color="orcamento" colspan="3">PREÇO NO ORÇAMENTO</th>
                    </tr>
                    <tr class="sub-header-row">
                        <th data-group="info" data-group-color="base">DATA BASE</th><th data-group="info" data-group-color="base">FONTE</th><th data-group="info" data-group-color="base">CÓDIGO</th><th data-group="info" data-group-color="base">DESCRIÇÃO DO SERVIÇO</th><th data-group="info" data-group-color="base">UNID.</th>
                        <th data-group="transp" data-group-color="transp"></th><th data-group="transp" data-group-color="transp">X1 (Km)</th><th data-group="transp" data-group-color="transp">X2 (Km)</th><th data-group="transp" data-group-color="transp">VALOR DO TRANSP.</th>
                        <th data-group="preco-tabela" data-group-color="base">M.O.</th><th data-group="preco-tabela" data-group-color="base">CUSTO</th>
                        <th data-group="preco-bdi" data-group-color="orcamento">TIPO BDI</th><th data-group="preco-bdi" data-group-color="orcamento">VALOR BDI</th><th data-group="preco-bdi" data-group-color="orcamento">PREÇO</th>
                        <th data-group="orcamento" data-group-color="orcamento">QUANT.</th><th data-group="orcamento" data-group-color="orcamento">SUBTOTAL</th><th data-group="orcamento" data-group-color="orcamento">ABC %</th>
                    </tr>
                </thead>
                <tbody class="align-middle">
                    <tr class="group-header" data-bs-toggle="collapse" data-bs-target=".grande-item-1" aria-expanded="true">
                        <td class="text-center"><a href="#"><i class="bi bi-chevron-down"></i></a></td>
                        <td class="group-title" colspan="17">1. SERVIÇOS PRELIMINARES E ADMINISTRATIVOS DA OBRA</td>
                        <td class="text-end pe-3">25.168,00</td><td class="text-end pe-3">89%</td>
                    </tr>
                    <tr class="subgroup-header collapse show grande-item-1" data-bs-toggle="collapse" data-bs-target=".subgrupo-1-1" aria-expanded="true">
                        <td></td><td class="text-center"><a href="#"><i class="bi bi-chevron-down"></i></a></td>
                        <td class="subgroup-title" colspan="16">1.1 INSTALAÇÕES PARA CANTEIROS DE OBRAS</td>
                        <td class="text-end pe-3"><strong>15.979,00</strong></td><td class="text-end pe-3"><strong>53%</strong></td>
                    </tr>
                    <tr class="collapse show subgrupo-1-1 grande-item-1">
                        <td></td><td class="text-center"><button class="btn btn-outline-danger btn-sm btn-action"><i class="bi bi-trash"></i></button></td>
                        <td data-group="info"><input type="text" class="form-control form-control-sm text-center" value="2020-04" readonly></td>
                        <td data-group="info"><input type="text" class="form-control form-control-sm text-center" value="SINAPI" readonly></td>
                        <td data-group="info"><input type="text" class="form-control form-control-sm text-center" value="10398" readonly></td>
                        <td data-group="info" class="description-col"><input type="text" class="form-control form-control-sm" value="FORNECIMENTO E INSTALAÇÃO DE PLACA DE OBRA..." readonly></td>
                        <td data-group="info"><input type="text" class="form-control form-control-sm text-center" value="M2" readonly></td>
                        <td data-group="transp"></td><td data-group="transp"><input type="number" class="form-control form-control-sm text-end"></td><td data-group="transp"><input type="number" class="form-control form-control-sm text-end"></td><td data-group="transp"><input type="text" class="form-control form-control-sm text-end" value="-" readonly></td>
                        <td data-group="preco-tabela"><input type="text" class="form-control form-control-sm text-end" value="33,00" readonly></td><td data-group="preco-tabela"><input type="text" class="form-control form-control-sm text-end" value="150,00" readonly></td>
                        <td data-group="preco-bdi"><select class="form-select form-select-sm"><option selected>Serviço</option><option>Material</option></select></td><td data-group="preco-bdi"><input type="text" class="form-control form-control-sm text-end" value="22,00" readonly></td><td data-group="preco-bdi"><input type="text" class="form-control form-control-sm text-end" value="157,00" readonly></td>
                        <td data-group="orcamento"><input type="number" class="form-control form-control-sm text-end" value="2.00"></td><td data-group="orcamento"><input type="text" class="form-control form-control-sm text-end" value="314,00" readonly></td><td data-group="orcamento"><input type="text" class="form-control form-control-sm text-end" value="1%" readonly></td>
                    </tr>
                    <tr class="collapse show subgrupo-1-1 grande-item-1 insert-service-cell">
                        <td></td><td class="text-start ps-3" colspan="18"><a href="#" class="btn-insert-link"><i class="bi bi-plus-circle me-2"></i>Inserir serviço</a></td>
                    </tr>
                    
                    <tr class="group-header" data-bs-toggle="collapse" data-bs-target=".grande-item-2" aria-expanded="false">
                        <td class="text-center"><a href="#"><i class="bi bi-chevron-right"></i></a></td>
                        <td class="group-title" colspan="17">2. FUNDAÇÕES E ESTRUTURA</td>
                        <td class="text-end pe-3">12.500,00</td><td class="text-end pe-3">10%</td>
                    </tr>
                    <tr class="subgroup-header collapse grande-item-2" data-bs-toggle="collapse" data-bs-target=".subgrupo-2-1" aria-expanded="false">
                        <td></td><td class="text-center"><a href="#"><i class="bi bi-chevron-right"></i></a></td>
                        <td class="subgroup-title" colspan="16">2.1 ESCAVAÇÃO E SERVIÇOS DE TERRA</td>
                        <td class="text-end pe-3"><strong>12.500,00</strong></td><td class="text-end pe-3"><strong>10%</strong></td>
                    </tr>
                    <tr class="collapse subgrupo-2-1 grande-item-2">
                         <td></td><td class="text-center"><button class="btn btn-outline-danger btn-sm btn-action"><i class="bi bi-trash"></i></button></td><td data-group="info"><input type="text" class="form-control form-control-sm text-center" value="2022-08" readonly></td><td data-group="info"><input type="text" class="form-control form-control-sm text-center" value="ORSE" readonly></td><td data-group="info"><input type="text" class="form-control form-control-sm text-center" value="22113" readonly></td><td data-group="info" class="description-col"><input type="text" class="form-control form-control-sm" value="ESCAVAÇÃO MANUAL DE VALAS" readonly></td><td data-group="info"><input type="text" class="form-control form-control-sm text-center" value="M³" readonly></td>
                        <td data-group="transp"></td><td data-group="transp"><input type="number" class="form-control form-control-sm text-end"></td><td data-group="transp"><input type="number" class="form-control form-control-sm text-end"></td><td data-group="transp"><input type="text" class="form-control form-control-sm text-end" value="-" readonly></td>
                        <td data-group="preco-tabela"><input type="text" class="form-control form-control-sm text-end" value="45,00" readonly></td><td data-group="preco-tabela"><input type="text" class="form-control form-control-sm text-end" value="80,00" readonly></td>
                        <td data-group="preco-bdi"><select class="form-select form-select-sm"><option selected>Serviço</option><option>Material</option></select></td><td data-group="preco-bdi"><input type="text" class="form-control form-control-sm text-end" value="15,00" readonly></td><td data-group="preco-bdi"><input type="text" class="form-control form-control-sm text-end" value="95,00" readonly></td>
                        <td data-group="orcamento"><input type="number" class="form-control form-control-sm text-end" value="100.00"></td><td data-group="orcamento"><input type="text" class="form-control form-control-sm text-end" value="9.500,00" readonly></td><td data-group="orcamento"><input type="text" class="form-control form-control-sm text-end" value="8%" readonly></td>
                    </tr>
                    <tr class="collapse subgrupo-2-1 grande-item-2 insert-service-cell">
                        <td></td><td class="text-start ps-3" colspan="18"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <footer class="footer-tabs fixed-bottom d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center ps-2"><button class="btn btn-sm text-white" style="background-color: var(--bs-success);">GLOBAL</button><button class="btn btn-sm btn-outline-secondary ms-2">INSTALAÇÃO</button></div>
        <div class="d-flex align-items-center">
            <ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" href="#">RUA 1 <i class="bi bi-x-circle ms-1"></i></a></li><li class="nav-item"><a class="nav-link" href="#">ATL_1 <i class="bi bi-x-circle ms-1"></i></a></li></ul>
            <button class="btn btn-link text-decoration-none" title="Adicionar nova aba" style="color: var(--bs-success);"><i class="bi bi-plus-circle-fill fs-5"></i></button>
        </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mainTable = document.getElementById('main-table');

            // --- LÓGICA DO MODO DE EDIÇÃO EM MASSA ---
            const massEditToggle = document.getElementById('viewModeToggle');
            massEditToggle.addEventListener('change', function(e) {
                if (e.target.value === 'mass-edit') {
                    document.body.classList.add('mass-edit-active');
                } else {
                    document.body.classList.remove('mass-edit-active');
                }
            });

            // --- LÓGICA DE COLLAPSE (EXPANDIR/RECOLHER) ---
            const collapseTriggers = document.querySelectorAll('[data-bs-toggle="collapse"]');
            collapseTriggers.forEach(function (trigger) {
                const icon = trigger.querySelector('.bi');
                if (!icon) return;
                const isExpanded = trigger.getAttribute('aria-expanded') === 'true';
                icon.classList.toggle('bi-chevron-down', isExpanded);
                icon.classList.toggle('bi-chevron-right', !isExpanded);
                trigger.addEventListener('click', function () {
                    icon.classList.toggle('bi-chevron-down');
                    icon.classList.toggle('bi-chevron-right');
                });
            });

            // --- LÓGICA DO MENU DE CONFIGURAÇÕES ---
            // 1. Controle de Tamanho da Fonte
            const fontButtons = document.querySelectorAll('#fontSizeGroup button');
            fontButtons.forEach(button => {
                button.addEventListener('click', function() {
                    fontButtons.forEach(btn => btn.classList.remove('active'));
                    mainTable.classList.remove('font-size-sm', 'font-size-md', 'font-size-lg');
                    this.classList.add('active');
                    mainTable.classList.add(`font-size-${this.dataset.fontSize}`);
                });
            });

            // 2. Lógica de Visibilidade de Colunas
            const columnToggles = document.querySelectorAll('.column-toggle');
            
            function updateColumnVisibility() {
                let visibleCols = 2; // Colunas fixas de ícones
                const groups = {};
                columnToggles.forEach(toggle => {
                    groups[toggle.dataset.group] = {
                        visible: toggle.checked,
                    };
                });

                mainTable.querySelectorAll('thead [data-group], tbody [data-group]').forEach(cell => {
                    const groupName = cell.dataset.group;
                    if (groupName in groups) {
                        cell.classList.toggle('d-none', !groups[groupName].visible);
                    }
                });
                
                mainTable.querySelectorAll('thead .main-header-row th[data-group]').forEach(th => {
                     const groupName = th.dataset.group;
                     let count = Array.from(mainTable.querySelectorAll(`thead .sub-header-row th[data-group="${groupName}"]:not(.d-none)`)).length;
                     th.setAttribute('colspan', count);
                });
            }

            columnToggles.forEach(toggle => {
                toggle.addEventListener('change', updateColumnVisibility);
            });

            updateColumnVisibility();
        });
    </script>
</body>
</html>